## Melody · 使用说明 (App User Guide)

### 目录 (Table of Contents)
- **快速上手 (Quick Start)**
- **首次启动与引导页 (First Launch & Onboarding)**
- **权限与数据来源 (Permissions & Data Sources)**
- **主页操作指南 (Home / Main Screen)**
- **AI 建议与休息模式 (AI Suggestions & Break Mode)**
- **五大放松会话 (Five Relax Sessions)**
- **个人中心 (Profile Center)**
- **设置与数据管理 (Settings & Data Management)**
- **数据详情 (Data History)**
- **媒体与音视频 (Media: Audio/Video)**
- **可访问性与交互提示 (Accessibility & Interaction Tips)**
- **常见问题与排查 (FAQ & Troubleshooting)**
- **隐私与安全 (Privacy & Security)**
- **兼容性与版本 (Compatibility & Version)**
- **联系我们 (Contact)**

---

### 快速上手 (Quick Start)
- **下载/构建**: 在 Xcode 中打开工程并运行目标 `melody_new`。
- **首次体验**: 按提示完成启动动画与 4 页 Onboarding 引导。
- **进入主页**: 查看顶部问候、选择一张扇形卡片开始一个放松会话。
- **记录与可视化**: 个人中心可查看最近 7/30 天统计、趋势与会话明细，并支持导出 CSV。

---

### 首次启动与引导页 (First Launch & Onboarding)
- **启动动画**: 打开 App 后先播放加载动画（无操作，完成即进入下一步）。
- **Onboarding**: 4 页沉浸式插画，点击屏幕逐步显示标题文字，再次点击切换下一页。
- **完成引导**: 第一次完成后会记录 `hasCompletedOnboarding`，下次启动将直接进入主页。

---

### 权限与数据来源 (Permissions & Data Sources)
- **日历权限（必需以启用智能推荐）**:
  - 允许访问“日历”以读取“当天事件”并基于空档时间提供建议。
  - 拒绝权限时仍可使用 App，但 AI 与本地时间推荐将无法精准匹配日程。
- **数据来源**:
  - 当日事件仅用于本地分析与生成“当日文本摘要”调用 AI；不会上传历史统计或任何识别信息。

---

### 主页操作指南 (Home / Main Screen)
- **顶部区域**:
  - 显示星期与标题“Melody”。
  - 头像按钮进入“个人中心”。
  - **AI 问候卡**: 自动获取鼓励短句或建议，可点击右下角“收起/展开”。
- **扇形卡片 (5 张)**:
  - 向左右滑动切换选中卡；点击非选中卡切换，点击“已选中卡”进入对应会话。
  - 卡片左上角出现“AI智能推荐”角标时，表示来源于 AI 的当前时段建议。
- **中部旋钮**:
  - 拖动旋钮刻度可切换当前选中卡，切换时有触觉反馈与随动动画。
- **底部日程**:
  - 条形进度显示当天忙碌/空闲时间区段；下方列表展示今日事件（起止时间）。

---

### AI 建议与休息模式 (AI Suggestions & Break Mode)
- **问候/短荐**:
  - 进入主页后自动获取一次；每 30 分钟刷新一次（非“休息模式”下）。
  - 若服务不可用，会显示失败提示，不影响本地推荐与正常使用。
- **本地时间推荐**:
  - 基于“距下一事件的可用分钟数”和“当前是否在事件中”，给出备用推荐（不显示 AI 角标）。
- **休息模式**:
  - 在“上个事件结束 ≥5 分钟、下个事件 ≤2 小时且 ≥15 分钟”的间隙自动触发。
  - 调用 AI 生成专注休息建议，页面问候文案替换为建议内容，并自动切换对应放松卡。
  - 到达建议的放松时长后自动退出休息模式并恢复原状态。

---

### 五大放松会话 (Five Relax Sessions)

#### 1) 深呼吸 (Breathing)
- **进入方式**: 主页选择“深呼吸”，或 AI 推荐切换到该卡后点击。
- **操作**: 支持“暂停/继续”；顶部显示倒计时；橙色渐变呼吸环随节奏呼吸。
- **时长**: 自动依据日程窗口建议 1–5 分钟，也可提前“完成”。
- **完成**: 自动记录到统计并返回主页。

#### 2) 冥想·种子 (Meditation)
- **进入方式**: 选择“种子”。
- **操作**: 点击屏幕推进 5 个成长阶段（种子→发芽→幼苗→成长→成熟）。
- **时长**: 自由控制，点击“完成冥想”记录并返回。

#### 3) 音乐疗愈 (Music)
- **进入方式**: 选择“音乐”。
- **操作**: 点击“START”开始；背景从“开始页”切换到“进行中”；顶部显示剩余秒数。
- **音频**: 自动播放内置 `music`；可调系统音量；到时自动弹出完成对话框。
- **完成**: 选择“完成”进入庆祝页，随后返回主页；统计记录会自动写入。

#### 4) 轻松拉伸 (Stretch)
- **进入方式**: 选择“运动”。
- **操作**: 中央播放拉伸动作视频（自动循环，裁切无黑边）。
- **完成**: 点击“完成拉伸”记录并返回主页。

#### 5) 戳泡泡 (Bubbles)
- **进入方式**: 选择“戳泡泡”。
- **操作**: 点击泡泡或按住屏幕在泡泡上方松开即可“爆破”；泡泡会有物理移动与边界反弹。
- **计时与得分**: 默认 60 秒；分数=泡泡大小加权；可“暂停/继续”。
- **结束**: 计时到 0 后显示“重新开始 / 结束”；点击“结束”进入“Yeah”小狗视频页，再返回主页；完成会自动记录。

---

### 个人中心 (Profile Center)
- **今日概览**: 今日放松时长、会话次数、连续天数（含趋势标识）。
- **趋势图表**: iOS16+ 使用 Charts 展示 7 天柱/线图；旧系统提供降级图表。
- **成就**: 连续使用、放松达人、会话数量等达成提示。
- **快速操作**: 数据详情、分享成就、帮助支持。
- **进入方式**: 主页右上角头像按钮。

---

### 设置与数据管理 (Settings & Data Management)
- **通知设置**: 开启/关闭提醒（需系统通知权限）。
- **每日目标**: 调整每日放松目标分钟数，变更时有触觉反馈。
- **偏好设置**: 开关音效与触觉反馈。
- **数据管理**:
  - **导出数据**: 以 CSV 导出总览统计，系统分享面板分享或保存。
  - **重置数据**: 清除所有统计与会话记录（不可恢复）。
- **关于**: 版本信息、开发者、隐私政策入口、反馈邮件。

---

### 数据详情 (Data History)
- **时间范围**: 7 天 / 30 天 / 全部（当前“全部”使用 30 天数据作简化）。
- **总体统计**: 总时长、总会话、最长连续、偏爱类型。
- **趋势**: 连续时间段分钟数走势（线图+面积或降级柱图）。
- **类型分布**: 各会话类型占比与进度条。
- **最近会话**: 最新 10 条记录（类型、时间、时长、完成状态）。

---

### 媒体与音视频 (Media: Audio/Video)
- **音乐**: 内置 `music` 音频资产；若设备静音或音量过低，可能听不到声音。
- **视频**: 启动画面与拉伸视频使用 `AVPlayerLayer` 且 `.resizeAspectFill` 保证无黑边；戳泡泡结束页与音乐完成庆祝页播放 `dog.mov`。

---

### 可访问性与交互提示 (Accessibility & Interaction Tips)
- **高对比度**: 重要按钮使用高对比度配色，文本字号自适应。
- **触觉反馈**: 切换卡片、完成会话、设置切换等关键交互提供震动反馈。
- **手势**: 卡片左右滑动切换；旋钮拖动切换；泡泡点击爆破；冥想点击推进阶段。

---

### 常见问题与排查 (FAQ & Troubleshooting)
- **看不到 AI 问候/推荐**:
  - 可能网络不稳定或 Token 未配置；稍后重试，或仅使用本地推荐继续体验。
- **日历为空**:
  - 请在“设置→隐私→日历”确保授予本应用权限，并确认当天日历确有事件。
- **音乐无声**:
  - 检查系统音量与静音键；若仍无声，重启应用重试。
- **视频不显示或黑边**:
  - 设备低内存或资源未正确打包，可尝试真机运行或清理派生数据后重构建。
- **统计不更新**:
  - 确认会话已“完成”；个人中心下拉刷新或返回主页再进入查看。

---

### 隐私与安全 (Privacy & Security)
- **最小化上传**: 仅上传“当日事件的文本摘要”用于 AI 推理；不包含历史统计、联系人或任何标识信息。
- **本地持久化**: 统计数据保存在本机 UserDefaults，可一键清除。
- **密钥管理**: AI Token 不硬编码，建议以环境变量或 Info.plist 注入。

---

### 兼容性与版本 (Compatibility & Version)
- **系统要求**: iOS 16+ 推荐；iOS 15 及以下图表功能会降级展示。
- **设备支持**: iPhone 主体适配；iPad 运行兼容基础功能。

---

### 联系我们 (Contact)
- **支持邮箱**: `melody@support.com`
- **反馈建议**: 个人中心 → 设置 → 关于/反馈


